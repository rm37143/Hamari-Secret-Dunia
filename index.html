<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Dunia 6star7p</title>
    <style>
        :root { --pink: #ff85a2; --glass: rgba(255, 255, 255, 0.9); --green: #2ecc71; --grey: #bdc3c7; --blue: #3498db; --dark: #444; --btn-bg: #fff0f3; }
        body { background: #fce4ec; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 15px; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 400px; text-align: center; }
        .main-title { color: var(--pink); margin: 10px 0 20px 0; font-size: 1.8rem; font-weight: bold; }
        .card { background: var(--glass); backdrop-filter: blur(10px); padding: 25px; border-radius: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid white; position: relative; }
        .status-bar { background: #fff; padding: 12px; border-radius: 15px; margin-bottom: 15px; font-size: 0.7rem; border-left: 6px solid var(--green); text-align: left; min-height: 20px; }
        .user-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #f9f9f9; }
        .dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; }
        .dot-online { background: var(--green); }
        .dot-offline { background: var(--grey); }
        textarea { width: 95%; border: none; background: transparent; padding: 10px; resize: none; outline: none; font-size: 1rem; color: #333; }
        .btn-main { background: var(--pink); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; width: 100%; cursor: pointer; }
        .msg-counter { font-size: 0.75rem; font-weight: bold; color: var(--pink); margin-bottom: 8px; display: block; background: #fff; padding: 6px; border-radius: 12px; border: 1px solid #eee; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        .hub-btn { background: var(--btn-bg); border: 1px solid #ffd1dc; padding: 15px 5px; border-radius: 18px; cursor: pointer; font-size: 0.75rem; font-weight: bold; color: #d63384; }
        #dashboard { display: none; }
        input { width: 85%; padding: 12px; margin: 10px 0; border-radius: 25px; border: 1px solid #eee; text-align: center; }
    </style>
</head>
<body onload="document.getElementById('u-name').value=''; document.getElementById('u-pass').value='';">

<div class="container">
    <h2 class="main-title">Secret Dunia</h2>
    <div id="login-screen" class="card">
        <input type="text" id="u-name" placeholder="User Name">
        <input type="password" id="u-pass" placeholder="Enter Key">
        <button class="btn-main" onclick="checkAuth()">Enter World</button>
    </div>

    <div id="dashboard">
        <div class="status-bar" id="status-container">Connecting...</div>
        <div class="card"><textarea id="note-input" placeholder="Write a Message..." onkeypress="if(event.key==='Enter') sendNote()"></textarea></div>
        <div class="card">
            <div id="unread-badge" class="msg-counter">Checking messages...</div>
            <button id="unlock-btn" class="btn-main" style="background:var(--dark);" onclick="unlockHistory()">Unlock Messages ðŸ”’</button>
            <div id="notes-display" style="display:none; text-align:left; margin-top:10px; max-height:200px; overflow-y:auto;"></div>
        </div>
        <div class="card"><div class="btn-grid" id="hub-grid"></div></div>
    </div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbznkxMVNroTC0x7aunSogKqE5Lrxs0JFVAWe4_5iATg1woA1CNICo9REHbOWwLLTXxy/exec';
    let currentUser = "", currentID = "";

    function checkAuth() {
        const n = document.getElementById('u-name').value.toUpperCase().trim();
        const p = document.getElementById('u-pass').value.trim();
        if(n && (p==='37143' || p==='n37143')) {
            currentUser = n; currentID = (p==='37143')?"USER1":"USER2";
            document.getElementById('login-screen').style.display='none';
            document.getElementById('dashboard').style.display='block';
            updateStatus("Online"); setInterval(refreshData, 5000); refreshData();
        } else { alert("Wrong!"); }
    }

    async function refreshData() {
        try {
            const res = await fetch(scriptURL);
            const data = await res.json();
            let sHtml = "";
            let otherSeen = 0, otherName = "User";

            data.onlineUsers.forEach(u => {
                if(u.name.toUpperCase() !== currentUser) { otherSeen = u.seenCount; otherName = u.name; }
                sHtml += `<div class="user-row"><span><span class="dot ${u.status==='Online'?'dot-online':'dot-offline'}"></span>${u.name}: ${u.status}</span></div>`;
            });
            document.getElementById('status-container').innerHTML = sHtml;

            let history = data.history || [];
            let badge = document.getElementById('unread-badge');
            if(history.length > 0) {
                let last = history[history.length-1];
                if(last.name.toUpperCase() === currentUser) {
                    badge.innerHTML = (otherSeen >= history.length) ? `âœ… ${otherName} Seen` : `â³ Sent (Pending...)`;
                } else {
                    let myData = data.onlineUsers.find(u => u.name.toUpperCase() === currentUser);
                    let unread = history.length - (myData ? myData.seenCount : 0);
                    badge.innerHTML = unread > 0 ? `ðŸ’Œ ${last.name}: ${unread} New` : `âœ… All Read`;
                }
            } else { badge.innerHTML = "No messages"; }
        } catch(e) { document.getElementById('status-container').innerHTML = "Wait, syncing..."; }
    }

    async function sendNote() {
        const msg = document.getElementById('note-input').value;
        if(!msg) return;
        await fetch(scriptURL, {method:'POST', body:JSON.stringify({name:currentUser, note:msg})});
        document.getElementById('note-input').value = ""; refreshData();
    }

    function updateStatus(s) { fetch(scriptURL, {method:'POST', body:JSON.stringify({action:"updateStatus", name:currentUser, status:s})}); }
</script>
</body>
</html>
